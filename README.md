# üß™ Gateway Stripe Sandbox - Vers√£o Completa

[![Stripe](https://img.shields.io/badge/Stripe-626CD9?style=for-the-badge&logo=Stripe&logoColor=white)](https://stripe.com)
[![Django](https://img.shields.io/badge/Django-092E20?style=for-the-badge&logo=django&logoColor=white)](https://djangoproject.com)
[![Python](https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white)](https://python.org)

Ambiente completo de testes para integra√ß√£o com Stripe usando Django, com suporte a **Cart√µes**, **PIX** e **Boletos** banc√°rios.

## üöÄ Funcionalidades Implementadas

### ‚úÖ Pagamentos com Cart√£o
- Cart√µes de teste do Stripe (sucesso, falha, 3D Secure)
- Valida√ß√£o de endere√ßo brasileiro completo
- Processamento instant√¢neo
- Webhooks funcionais

### ‚úÖ Gera√ß√£o de Boletos
- **NOVA FUNCIONALIDADE:** Boletos banc√°rios via Stripe
- Valida√ß√£o de CPF/CNPJ com m√°scara autom√°tica
- Endere√ßo de cobran√ßa obrigat√≥rio
- Expira√ß√£o configur√°vel (3 dias √∫teis)
- Interface totalmente brasileira

### ‚ö†Ô∏è PIX (Em Desenvolvimento)
- Interface preparada para PIX
- **PROBLEMA IDENTIFICADO:** Funcionalidade n√£o operacional
- Necessita revis√£o na integra√ß√£o com Stripe
- Simula√ß√£o de QR Code implementada

### üîß Recursos Administrativos
- Interface admin Django completa
- Hist√≥rico detalhado de transa√ß√µes
- Logs de webhooks para debug
- Status de pagamento em tempo real

## üõ†Ô∏è Tecnologias

- **Django 4.2.7** - Framework web Python
- **Stripe 7.8.0** - Gateway de pagamento
- **ngrok** - T√∫nel para webhooks locais
- **SQLite** - Banco de dados para desenvolvimento
- **CSS/JavaScript** - Interface responsiva

## ‚ö° Setup R√°pido

### 1. Clone e Configure o Ambiente
```bash
# Clone o reposit√≥rio
git clone <seu-repositorio>
cd gateway-stripe-sandbox

# Crie e ative virtual environment
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac  
source venv/bin/activate

# Instale depend√™ncias
pip install -r requirements.txt
```

### 2. Configure Vari√°veis de Ambiente
```bash
# Copie o arquivo de exemplo
cp .env.example .env
```

Edite o `.env` com suas credenciais do Stripe:
```env
DEBUG=True
SECRET_KEY=sua-secret-key-django-aqui

# Stripe Test Keys (https://dashboard.stripe.com/test/apikeys)
STRIPE_PUBLISHABLE_KEY=pk_test_51...
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_WEBHOOK_SECRET=whsec_...
```

### 3. Execute Migra√ß√µes e Configure
```bash
# Execute migra√ß√µes
python manage.py makemigrations
python manage.py migrate

# Crie superusu√°rio
python manage.py createsuperuser

# Crie produtos de exemplo
python manage.py shell
```

No shell Django:
```python
from payments.models import Product

produtos = [
    {'name': 'Curso Python Avan√ßado', 'description': 'Curso completo de Python com Django', 'price': 197.00},
    {'name': 'E-book Stripe Brasil', 'description': 'Guia definitivo do Stripe no Brasil', 'price': 47.90},
    {'name': 'Consultoria 1h', 'description': 'Mentoria personalizada em pagamentos', 'price': 250.00},
    {'name': 'Workshop Boletos', 'description': 'Como implementar boletos com Stripe', 'price': 97.00},
]

for p in produtos:
    Product.objects.get_or_create(name=p['name'], defaults=p)
    print(f"‚úÖ {p['name']} criado")

exit()
```

### 4. Execute o Projeto

**Windows (Recomendado):**
```bash
.\run_ernane.bat
```

**Manual:**
```bash
python manage.py runserver
```

## üß™ Testando o Sistema

### üí≥ Cart√µes de Teste

| Cen√°rio | N√∫mero do Cart√£o | CVC | Data | Resultado |
|---------|------------------|-----|------|-----------|
| ‚úÖ **Sucesso** | `4242 4242 4242 4242` | `123` | `12/25` | Aprovado |
| ‚ùå **Recusado** | `4000 0000 0000 0002` | `123` | `12/25` | Negado |
| üîê **3D Secure** | `4000 0000 0000 3220` | `123` | `12/25` | Autentica√ß√£o |
| üí∏ **Sem Saldo** | `4000 0000 0000 9995` | `123` | `12/25` | Insuficiente |

### üìÑ Boletos de Teste

**CPF/CNPJ para Teste:**
- CPF: `12345678901` (formato autom√°tico: 123.456.789-01)
- CNPJ: `12345678000100` (formato autom√°tico: 12.345.678/0001-00)

**Endere√ßos de Teste:**
- CEP: `01310-100` (Av. Paulista, S√£o Paulo)
- CEP: `20040-020` (Centro, Rio de Janeiro)

### üè¶ PIX (N√£o Funcional)
‚ö†Ô∏è **Status:** Em desenvolvimento - necessita corre√ß√£o na integra√ß√£o

### Fluxo de Teste Completo:
1. Acesse: http://127.0.0.1:8000
2. Clique "üîê Login Sandbox"
3. Escolha um produto ‚Üí "üõí Comprar Agora"
4. Selecione m√©todo de pagamento:
   - **Cart√£o:** Use cart√µes de teste
   - **Boleto:** Preencha dados brasileiros
   - **PIX:** ‚ö†Ô∏è N√£o funcional (em corre√ß√£o)
5. Complete o pagamento
6. Verifique resultado na p√°gina de sucesso

## üîó Configura√ß√£o de Webhooks

### Setup com ngrok:

1. **Instale ngrok:** https://ngrok.com/download

2. **Configure authtoken:**
   ```bash
   ngrok authtoken SEU_TOKEN
   ```

3. **Execute ngrok:**
   ```bash
   ngrok http 8000
   ```

4. **Configure no Stripe Dashboard:**
   - URL: `https://seu-ngrok.ngrok.io/webhook/stripe/`
   - Eventos selecionados:
     - `payment_intent.succeeded`
     - `payment_intent.payment_failed`
     - `payment_intent.requires_action`
     - `payment_intent.canceled`
     - `payment_intent.processing`

## üìä Interface Administrativa

**Acesso:** http://127.0.0.1:8000/admin/

### Funcionalidades Admin:
- **üì¶ Produtos:** Cadastro e gerenciamento do cat√°logo
- **üí≥ Pagamentos:** Hist√≥rico completo com status coloridos
- **üîó Webhooks:** Log detalhado de eventos recebidos
- **üë• Usu√°rios:** Gerenciamento de contas de teste

### Status de Pagamento:
- üü° **Pendente** - Aguardando processamento
- üîµ **Processando** - Em andamento
- üü¢ **Aprovado** - Pagamento conclu√≠do
- üî¥ **Falhou** - Transa√ß√£o recusada
- ‚ö™ **Cancelado** - Cancelado pelo usu√°rio
- üü† **Requer A√ß√£o** - Necessita autentica√ß√£o

## üìÅ Estrutura do Projeto

```
gateway-stripe-sandbox/
‚îú‚îÄ‚îÄ üìÑ manage.py
‚îú‚îÄ‚îÄ üìÑ requirements.txt
‚îú‚îÄ‚îÄ üìÑ .env.example
‚îú‚îÄ‚îÄ üìÑ run_ernane.bat           # Script automatizado Windows
‚îú‚îÄ‚îÄ üìÅ stripe_sandbox/          # Configura√ß√µes Django
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ settings.py         # Configura√ß√µes principais
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ urls.py             # URLs raiz
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ wsgi.py             # WSGI config
‚îú‚îÄ‚îÄ üìÅ payments/                # App principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ models.py           # Product, Payment, WebhookEvent
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ views.py            # L√≥gica de pagamento
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ admin.py            # Interface administrativa
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ urls.py             # Rotas do app
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ migrations/         # Migra√ß√µes do banco
‚îú‚îÄ‚îÄ üìÅ templates/               # Templates HTML
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ payments/
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ base.html       # Layout base
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ index.html      # P√°gina inicial
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ checkout.html   # Checkout (NOVO: boletos)
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ success.html    # P√°gina de sucesso
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ history.html    # Hist√≥rico
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ payment_detail.html # Detalhes
‚îî‚îÄ‚îÄ üìÅ static/                  # Arquivos est√°ticos
```

## üîß Comandos √öteis

### Gerenciamento do Banco:
```bash
# Reset completo do banco
rm db.sqlite3
python manage.py migrate

# Nova migra√ß√£o
python manage.py makemigrations payments
python manage.py migrate

# Verificar migra√ß√µes
python manage.py showmigrations
```

### Debug e Desenvolvimento:
```bash
# Shell interativo Django
python manage.py shell

# Executar testes
python manage.py test

# Coletar arquivos est√°ticos
python manage.py collectstatic

# Verificar configura√ß√£o
python manage.py check
```

### Logs e Monitoramento:
```bash
# Ver logs em tempo real (se configurado)
tail -f logs/django.log

# Debug do Stripe no shell
python manage.py shell
>>> import stripe
>>> stripe.api_key = 'sk_test_...'
>>> stripe.Product.list()
```

## üêõ Problemas Conhecidos e Solu√ß√µes

### ‚ùå PIX N√£o Funcional
**Problema:** Interface criada mas integra√ß√£o n√£o operacional
**Status:** üîß Em corre√ß√£o
**Workaround:** Use cart√µes ou boletos para testes

### ‚ö†Ô∏è Erro de Authtoken (ngrok)
**Solu√ß√£o:**
```bash
ngrok authtoken SEU_TOKEN_DO_NGROK
```

### ‚ö†Ô∏è Erro de Chaves Stripe
**Verifica√ß√£o:** Certifique-se de usar chaves de **teste** (pk_test_, sk_test_)

### ‚ö†Ô∏è Webhook N√£o Recebe Eventos
**Solu√ß√µes:**
1. Verificar se ngrok est√° ativo
2. Confirmar URL no Stripe Dashboard
3. Validar `STRIPE_WEBHOOK_SECRET` no .env
4. Testar endpoint: `curl -X POST https://seu-ngrok.ngrok.io/webhook/stripe/`

### ‚ö†Ô∏è Erro de Migra√ß√£o
```bash
python manage.py migrate --fake payments zero
python manage.py migrate
```

## üìö Recursos e Documenta√ß√£o

### Stripe:
- **Documenta√ß√£o Oficial:** https://stripe.com/docs
- **Cart√µes de Teste:** https://stripe.com/docs/testing#cards
- **Dashboard Teste:** https://dashboard.stripe.com/test
- **Webhooks Guide:** https://stripe.com/docs/webhooks

### Django:
- **Documenta√ß√£o:** https://docs.djangoproject.com/
- **Tutorial:** https://docs.djangoproject.com/en/4.2/intro/tutorial01/

### Ferramentas:
- **ngrok:** https://ngrok.com/docs
- **Git:** https://git-scm.com/docs

## üöÄ Pr√≥ximas Implementa√ß√µes

### üîÑ Em Desenvolvimento:
- [ ] **Corre√ß√£o do PIX** - Revisar integra√ß√£o com Stripe
- [ ] **Webhook melhorado** - Mais eventos e logs
- [ ] **Interface mobile** - Responsividade aprimorada
- [ ] **Testes automatizados** - Cobertura completa

### üí° Funcionalidades Planejadas:
- [ ] **Assinaturas** - Pagamentos recorrentes
- [ ] **Cupons de desconto** - Sistema promocional
- [ ] **Multi-vendedores** - Marketplace
- [ ] **Relat√≥rios avan√ßados** - Analytics detalhados
- [ ] **API REST** - Endpoints para integra√ß√µes
- [ ] **Docker** - Containeriza√ß√£o
- [ ] **Deployment** - Heroku/AWS

## ü§ù Como Contribuir

### Para Desenvolvedores:

1. **Fork o projeto**
   ```bash
   git clone https://github.com/seu-usuario/gateway-stripe-sandbox.git
   ```

2. **Crie uma branch para feature**
   ```bash
   git checkout -b feature/nova-funcionalidade
   ```

3. **Desenvolva e teste**
   ```bash
   # Fa√ßa suas altera√ß√µes
   python manage.py test
   ```

4. **Commit e Push**
   ```bash
   git add .
   git commit -m "feat: adiciona nova funcionalidade X"
   git push origin feature/nova-funcionalidade
   ```

5. **Abra Pull Request**

### üêõ Reportar Bugs:
- Use as **Issues** do GitHub
- Inclua prints e logs
- Descreva passos para reproduzir

### üí° Sugerir Melhorias:
- Abra uma **Discussion** no reposit√≥rio
- Explique o caso de uso
- Proponha implementa√ß√£o

## üìù Changelog

### v2.0.0 (Atual) - Boletos Implementados
- ‚úÖ **Adicionado:** Suporte completo a boletos banc√°rios
- ‚úÖ **Adicionado:** Valida√ß√£o de CPF/CNPJ com m√°scaras
- ‚úÖ **Adicionado:** Auto-preenchimento de endere√ßo via CEP
- ‚úÖ **Melhorado:** Interface de checkout mais intuitiva
- ‚úÖ **Melhorado:** Valida√ß√£o de campos obrigat√≥rios
- ‚ùå **Conhecido:** PIX n√£o funcional (ser√° corrigido em v2.1.0)

### v1.0.0 - Vers√£o Base
- ‚úÖ Pagamentos com cart√£o
- ‚úÖ Webhooks b√°sicos
- ‚úÖ Interface administrativa
- ‚úÖ Hist√≥rico de transa√ß√µes

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa **MIT**. Consulte o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Ernane** - [@ernanegit](https://github.com/ernanegit)

- üíº LinkedIn: [seu-linkedin]
- üìß Email: [seu-email]
- üåê Site: [seu-site]

---

## üéØ Status do Projeto

| Funcionalidade | Status | Observa√ß√µes |
|---------------|--------|-------------|
| üí≥ **Cart√µes** | ‚úÖ Funcional | Todos os cen√°rios testados |
| üìÑ **Boletos** | ‚úÖ Funcional | Implementa√ß√£o completa |
| üè¶ **PIX** | ‚ùå Em Corre√ß√£o | Interface pronta, integra√ß√£o pendente |
| üîó **Webhooks** | ‚úÖ Funcional | Eventos principais cobertos |
| üìä **Admin** | ‚úÖ Funcional | Interface completa |
| üì± **Mobile** | ‚ö†Ô∏è B√°sico | Responsivo, melhorias planejadas |

‚≠ê **D√™ uma estrela se este projeto te ajudou!**

üêõ **Encontrou um bug?** Abra uma issue!

üí° **Tem uma ideia?** Compartilhe conosco!

---

*√öltima atualiza√ß√£o: Junho 2025*